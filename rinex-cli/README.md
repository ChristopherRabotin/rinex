RINEX-cli 
=========

Command line tool to parse, analyze and manage RINEX files.  

[![crates.io](https://img.shields.io/crates/v/rinex-cli.svg)](https://crates.io/crates/rinex-cli)
[![License](https://img.shields.io/badge/license-Apache%202.0-blue?style=flat-square)](https://github.com/gwbres/rinex/blob/main/LICENSE-APACHE)
[![License](https://img.shields.io/badge/license-MIT-blue?style=flat-square)](https://github.com/gwbres/rinex/blob/main/LICENSE-MIT) 

The first purpose of this tool is to expose the [library](https://github.com/gwbres/rinex/rinex) 
in a high level and easy to use fashion.  
The application will be able to parse all RINEX formats supported by the library, refer to the front page to understand which RINEX format is currently supported.

Some GNSS data processing algorithms are implemented,
like 
- signal recombination
- signal analysis (DCBs, MP, ...)

Refer to [the dedicated page](doc/processing.md)

Some `teqc` operations are supported, see the 
[following paragraph](https://github.com/gwbres/rinex/blob/main/rinex-cli/README.md#teqc-operations)

## RINEX files

Several RINEX files exist. The tool support most RINEX formats, some exotic formats
are still under development, refer to the 
[main table](https://github.com/gwbres/rinex/blob/main/README.md#supported-rinex-types)

### File naming conventions

File names are disregarded by these tools, you can analyze
& parse files that do not follow naming conventions.

When producing data, this tool will eventually help the user to generate RINEX that follows
naming conventions, but that is currently under development.

### Compressed data

CRINEX (V1 and V3) are natively supported.

This tool supports gzip compressed files, as long as their name is terminated
by `.gz`.

## Data visualization & analysis

Most data analysis produce plots. 
RINEX record analysis can be converted to graphical with `--plot`.  
Plots currently come in the form of PNG files.

Efficient plotting is tied to efficient data filtering and resampling,
because RINEX files contain a lot of data.

Example of received signal power analysis:

<img align="center" width="650" src="https://github.com/gwbres/rinex/blob/main/doc/plots/esbc00dnk_glo_ssi.png">

Data is most of the time plotted against time.   
Time axis represents UTC epochs, normalized to 1st epoch (starting a "0"),
and expressed in seconds. 

## `teqc` operations

`teqc` is a well known application to process RINEX.   
Unlike teqc, this application is not capable of processing Binary RINEX ("BINEX") and 
proprietary formats in general.

Some teqc operations are supported:

- [merge](doc/merge.md) several RINEX together into a single file.
- [split](doc/split.md) given RINEX into two
- [resampling](doc/sampling.md) to reduce data quantity
- [ascii-plot](doc/ascii-plot.md)
to print a very descriptive tiny plot in the terminal,
as contained in reports generated by teqc

## Getting started

Install dependencies:

```shell
apt-get install libfontconfig1-dev
```

Always compile Rust code with the `--release` flag
for optimized implementation.   
Cf. our [benchmark results](https://github.com/gwbres/rinex/blob/main/README.md#performances)
to see how optimized code compares to non optimized (`--debug`).

```shell
cargo build --release
./target/release/rinex-cli -h
```

In the following "rinex-cli" means "target/release/rinex-cli" previously compiled.

Arguments order does not matter for the application.   

```bash
rinex-cli --fp /tmp/amel010.21g
```

Some arguments support an array of values to be given,
in this case, we use a CSV description. 

For instance, when retaining specific vehicules:

```bash
rinex-cli \
     -f test_resources/OBS/V2/rovn0010.21o \
        --retain-sv G01,G02
```

### Tool philosophy

The tool expects one RINEX file passed with `--fp`.  

Basic RINEX identification is triggered by requesting data enumarations,
like encountered Epochs (`--epoch`) or Sv (`--sv`). In this mode,
only console visualization exists and data is presented in JSON format.
Refer to 
[JSON section](https://github.com/gwbres/rinex/tree/main/rinex-cli/README.md#readable-json)
for more detail.

Most RINEX analysis are graphical, that means one or several PNG files are to be generated.
Advanced operations (RINEX processing) require a Navigaton Context to be provided
(`--nav`), and such analysis are always graphical.

RINEX record analysis is by default presented in JSON format, but
graphical view can be activated with `--plot`. 
Data is highly dependent on the file that was provided (`--fp`).

### Readable JSON 

This tool uses JSON format to expose data by default. 
This makes it easy to import into other tools,
for instance external Python scripts with `Eval()`.

The `--pretty` argument improves the rendering of JSON
data, to make it readable.

```bash
rinex-cli --pretty -f /tmp/amel010.21g \
      --epoch --sv-filter R01,G01 

rinex-cli -f /tmp/amel010.21g \
      --decimate-interval 00:05:00 \
            --sv-filter G01 --pretty
``` 

## RINEX Identification

Basic Identification consists in extracting high level information to understand which 
data is contained in a given RINEX.
Examples of such information would be `Epoch` enumeration, or `Sv` enumeration.  

For example, identify encountered epochs:

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs --pretty
``` 

As always, Identification operations can be stacked together, to perform several at once.
For example, identify encountered vehicules at the same time:

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs --sv --pretty
``` 

## RINEX basic analysis

Several basic analysis can be performed,
some are graphical (--plot is assumed whatever happens) like `--sv-epoch` for instance,
some are optionnaly graphical (--plot is an option).

Refer to [this page](doc/analysis.md).

## RINEX Record analysis

If both RINEX identification and analysis modes were not activated,
we will perform Record analysis.   

[Filtering](doc/filtering.md) or [Resampling](doc/resampling.md) 
operations can be stacked to Record analysis,
to focus on data of interest.

By default, Record analysis is exposed as JSON structure.  
For supported RINEX files, the `--plot` flag can be passed to switch to data visualization.  
Plotting becomes very handy for huge RINEX files. 

Move to the [record analysis page](doc/record.md) for thorough
examples of RINEX record manipulations.

## File generation

Like input files, output files do not have to follow RINEX naming conventions.  
Eventually, this tool might have a file creation helper, to help the user
follow naming conventions, but it is currenly under development.

File generation applies to all the following operations

* [filtering](doc/filtering.md): create a new RINEX from the stripped RINEX content
* [merge](doc/merge.md): merge two files into a single RINEX
* [split](doc/split.md): split a file into two.

For example, let's extract G01 from this file

```bash
rinex-cli -f test_resources/CRNX/V3/ESBC00DNK_R_20201770000_01D_30S_MO.crx.gz \
    --retain-sv \
        --output g01.txt
```

Header section is simply copied and maintained.

### File generation and compression

It is possible compress data to .gz directly, if the specified `--output` 
is terminated by `.gz`.

It is also possible to convert Observation Data to CRINEX directly
* to CRINX1 if the specified `--output` is terminated by a standard YYd termination
* to CRINX3 if the specified `--output` is termined by `.crx`

In cases where CRINEX conversion is feasible, 
it is possible to stack the `.gz` compression on top of it
* YYd.gz to specify a CRNX1 + gz
* crx.gz to specify a CRNX3 + gz

Likewise, the mirror operations are feasible:

* extract `.gz` compressed data and dump it as readable
* extract a CRINEX and dump it as a readable RINEX

### Header section customization

A header section customization interface is currently under development.  
It is possible to pass custom header fields, one per `--output` flag,
to customize such section of the RINEX to be generated.

The `custom-header` flag accepts either a direct JSON description
of the `Rinex::Header` structure, or a local file containing
such a description.

```bash
# list encountered "observables"
rinex-cli -f test_resources/OBS/V3/CBW100NLD_R_20210010000_01D_MN.rnx --obs

# extract raw phase data and pseudo range only
```
