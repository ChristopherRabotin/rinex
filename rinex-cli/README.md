RINEX-cli 
=========

Command line tool to parse, analyze and manage RINEX files.  

[![crates.io](https://img.shields.io/crates/v/rinex-cli.svg)](https://crates.io/crates/rinex-cli)
[![License](https://img.shields.io/badge/license-Apache%202.0-blue?style=flat-square)](https://github.com/gwbres/rinex/blob/main/LICENSE-APACHE)
[![License](https://img.shields.io/badge/license-MIT-blue?style=flat-square)](https://github.com/gwbres/rinex/blob/main/LICENSE-MIT) 

The first purpose of this tool is to expose the [library](https://github.com/gwbres/rinex/rinex) 
in a high level and easy to use fashion.  
The application will be able to parse all RINEX formats supported by the library, refer to the front page to understand which RINEX format is currently supported.

The application knows a few `teqc` operations, refer to the
[dedicated paragraph](https://github.com/gwbres/rinex/blob/main/rinex-cli/README.md#teqc-operations)
down below.

This tool will eventually be able to perform most common RINEX 
[post-processing](https://github.com/gwbres/rinex/blob/main/rinex-cli/README.md#post-processing).

## RINEX files

Several RINEX files exist. The tool support most RINEX formats, some exotic formats
are still under development, refer to the 
[main table](https://github.com/gwbres/rinex/blob/main/README.md#supported-rinex-types)

### File naming conventions

File names are disregarded by these tools, you can analyze
& parse files that do not follow naming conventions.

When producing data, this tool will eventually help the user to generate RINEX that follows
naming conventions, but that is currently under development.

### Compressed data

CRINEX (V1 and V3) are natively supported.

This tool supports gzip compressed files, as long as their name is terminated
by `.gz`.

## Data visualization

Some specific analysis will generate one or several PNG files.  
Record analysis can be graphical if desired too (`--plot`).  
Refer to the
[following section](https://github.com/gwbres/rinex/tree/main/rinex-cli/README.md#plotting)

## `teqc` operations

`teqc` is a well known application to process RINEX.   
Unlike teqc, this application is not capable of processing Binary RINEX ("BINEX") and 
proprietary formats in general.

Some teqc operations are supported:

- [merge](doc/merge.md) several RINEX together into a single file.
- [resampling](doc/sampling.md) RINEX record to reduce the quantity of data to analyze
- [split](doc/split.md) given RINEX into two
- [ascii-plot](doc/ascii-plot.md)
to print a very descriptive tiny plot in the terminal,
as contained in reports generated by teqc

## Getting started

Install dependencies:

```shell
apt-get install libfontconfig1-dev
```

Always compile Rust code with the `--release` flag,
so the implementation gets optimized 
(see our [benchmark results](https://github.com/gwbres/rinex/blob/main/README.md#performances)
that emphasize its impact):

```shell
cargo build --release
./target/release/rinex-cli -h
```

In the following "rinex-cli" means "target/release/rinex-cli" previously compiled

Arguments order does not matter for the application.   

```bash
rinex-cli --fp /tmp/amel010.21g
```

Some arguments support an array of values to be given,
in this case, we use a CSV description. For instance, when retaining specific vehicules:

```bash
rinex-cli \
     -f test_resources/OBS/V2/rovn0010.21o \
        --retain-sv G01,G02
```

### Tool philosophy

The tool expects one RINEX file passed with `--fp`.  

For basic RINEX identification, like encountered `Epochs` or `Sv`,
only console visualization exists. The data is extracted in JSON format,
refer to the 
[JSON section](https://github.com/gwbres/rinex/tree/main/rinex-cli/README.md#readable-json)
for more information.

Anytime you see `Display` in the requested action menu,
the `--plot` flag can be used to generate a plot out of the extracted data.
Refer to specific sections for more information.

Advanced operations exist, some are file dependent
(for example: only for Navigation RINEX),
some require the addition of a Navigation Context (second RINEX file)
to be passed with `--nav`.

### Readable JSON 

This tool uses JSON format to expose data by default. 
This makes it easy to import into other tools,
for instance external Python scripts with `Eval()`.

The `--pretty` argument improves the rendering of JSON
data, to make it readable.

```bash
rinex-cli --pretty -f /tmp/amel010.21g \
      --epoch --sv-filter R01,G01 

rinex-cli -f /tmp/amel010.21g \
      --decimate-interval 00:05:00 \
            --sv-filter G01 --pretty
``` 

## RINEX Identification

Basic Identification consists in extracting high level information to understand which 
data is contained in a given RINEX.
Examples of such information would be `Epoch` enumeration, or `Sv` enumeration.  

For example, identify encountered epochs:

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs --pretty
``` 

As always, Identification operations can be stacked together, to perform several at once.
For example, identify encountered vehicules at the same time:

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --epochs --sv --pretty
``` 

## RINEX basic analysis

Several basic analysis can be performed,
some are graphical (--plot is assumed whatever happens) like `--sv-epoch` for instance,
some are optionnaly graphical (--plot is an option).

Refer to [this page](doc/analysis.md).

## RINEX Record analysis

If both RINEX identification and analysis modes were not activated,
we will perform Record analysis.   
[Filtering](doc/filtering.md) or [Resampling](doc/resampling.md) 
operations can be stacked to Record analysis,
for focus on data of interest.

By default, Record analysis is exposed as JSON structure.  
For [supported RINEX record](https://github.com/gwbres/blob/main/README.md),
the `--plot` flag can be passed to switch to data visualization.
In this mode, one ore more PNG files will be generated.  
The plot are RINEX dependent. For instance, 

* in case of Observation RINEX, one plot per physics
is to be generated. One plot for Receiver Clock Offsets is also to be generated,
if such information was provided

* in case of Navigation RINEX, one plot per physics
is to be generated. We group orbit fields by matching physics
and display such information. Since Navigation RINEX comprises
many orbit fields, we highly recommend filtering the record
with dedicated [filter operations](doc/filtereing.md)

Example: Observation analysis

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --retain-sv G06 --pretty
```

Example: Graphical analysis:

```bash
rinex-cli -f test_resources/OBS/V2/KOSG0010.95O --retain-sv G06 --plot
```

## File generation

Like input files, output files do not have to follow RINEX naming conventions.  
Eventually, this tool might have a file creation helper, to help the user
follow naming conventions, but it is currenly under development.

File generation applies to all the following operations

* [filtering](doc/filtering.md): create a new RINEX from the stripped RINEX content
* [merge](doc/merge.md): merge two files into a single RINEX
* [split](doc/split.md): split a file into two.

For example, let's extract G01 from this file

```bash
rinex-cli -f test_resources/CRNX/V3/ESBC00DNK_R_20201770000_01D_30S_MO.crx.gz \
    --retain-sv \
        --output g01.txt
```

Header section is simply copied and maintained.

### File generation and compression

It is possible compress data to .gz directly, if the specified `--output` 
is terminated by `.gz`.

It is also possible to convert Observation Data to CRINEX directly
* to CRINX1 if the specified `--output` is terminated by a standard YYd termination
* to CRINX3 if the specified `--output` is termined by `.crx`

In cases where CRINEX conversion is feasible, 
it is possible to stack the `.gz` compression on top of it
* YYd.gz to specify a CRNX1 + gz
* crx.gz to specify a CRNX3 + gz

Likewise, the mirror operations are feasible:

* extract `.gz` compressed data and dump it as readable
* extract a CRINEX and dump it as a readable RINEX

### Header section customization

A header section customization interface is currently under development.  
It is possible to pass custom header fields, one per `--output` flag,
to customize such section of the RINEX to be generated.

The `custom-header` flag accepts either a direct JSON description
of the `Rinex::Header` structure, or a local file containing
such a description.

```bash
# list encountered "observables"
rinex-cli -f test_resources/OBS/V3/CBW100NLD_R_20210010000_01D_MN.rnx --obs

# extract raw phase data and pseudo range only
```

## Plotting

Some analysis will generate PNG file(s) and Record analysis
can be converted to graphical mode if desired, with `--plot`.

PNG is the only supported format to this day. This tool is not a GUI,
we can only export static images too.

Most analysis are performed against Time (x = time axis), for simplicity we
use Modified Julian Days to represent epochs in this case.
